## Accessing a Weather API
You can write programs to interact with other programs through their *application programming interface (API)*, which is the specification that defines how one piece of software (such as your Python program) can communicate with another piece of software (such as the web server for a weather site). Online services often have APIs. For example, you could write a Python script to post to your social media accounts or download new photos. We’ll write a script that accesses weather information from the free OpenWeather website.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Almost all online services require you to register an email address to use their API. Even if the API is free, they may have limits to how many API requests you can make per hour or day. If you’re worried about receiving spam email, you can use a temporary, disposable email address service such as *https://10minutemail.com*. Keep in mind that you should use such services only to register for online accounts you don’t care about, as an unscrupulous email service could take control of your online account by making a password reset request in your name.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To start, sign up for a free account at *https://openweathermap.org*. The free account tier limits you to making 60 API requests per minute. This is more than enough for your small or medium-sized programming projects. If your program needs more than this limit (say, because it’s processing requests from hundreds of simultaneous visitors to your website), you can purchase a paid account tier. Online services will give you an *API key*, which is sort 
of a password that identifies your account in your API requests. Keep this API key a secret! Anyone with this key can make API requests credited to your account. If you write a program that uses an API key, consider having the program read a text file that contains the key instead of including the API key directly in your source code. This way, you can share your program with others (who can sign up for their own API key) without worrying about exceeding the API request limits of your account.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Many HTTP APIs deliver their responses as one large string. This string is often formatted as JSON or XML. `json.loads(response.text)` returns a Python data structure of lists and dictionaries containing the JSON 
data in `response.text`. Our examples will store this data in a variable named `response_data`, but this is an arbitrary choice, and you can use any variable name you’d like.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;All online services document how to use their API. OpenWeather provides its documentation at *https://openweathermap.org/api*. After you’ve logged in to your account and obtained your API key from the *My API keys* page at *https://home.openweathermap.org/api_keys*, use it in the following interactive shell code. I’ll use '30ee784a80d81480dab1749d33980112' as a fake API key in this example. Don’t use this fake API key example in your code; it won’t work.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;First, you’ll use OpenWeather to find the latitude and longitude of San Francisco:
```python
import requests

city_name = 'San Francisco'
state_code = 'CA'
country_code = 'US'
API_key = '30ee784a80d81480dab1749d33980112'  # Not a real API key

response = requests.get(f'https://api.openweathermap.org/geo/1.0/direct?q={city_name},{state_code},country_code}&appid=API_key}')
response.text  # This is a Python string
'[{"name":"San Francisco","local_names":{"id":"San Francisco",--snip-
,"lat":37.7790262,"lon":-122.419906,"country":"US","state":"California"}]'

import json
response_data = json.loads(response.text)
response_data  # This is a Python data structure.
[{"name":"San Francisco","local_names":{"id":"San Francisco",--snip-
,"lat":37.7790262,"lon":-122.419906,"country":"US","state":"California"}]
```
To understand the data in the response, you should look at the online API documentation for OpenWeather or examine the dictionary in `response_data` in the interactive shell. You’ll learn that the response is a list whose first item (at index 0) is a dictionary with keys `'lat'` and `'lon'`. The values for these keys are float values of the latitude and longitude:
```python
response_data[0]['lat'] # 37.7790262
response_data[0]['lon'] # -122.419906
```
The specific URL used to make an API request is called the *endpoint*. The f-strings in this example replace the parts in curly brackets with the values of variables. The `direct?q={city_name},{state_code},{country_code}&appid={API_key}'` in the previous example becomes `direct?q=San Francisco,CA,US&appid=30ee784a80d81480dab1749d33980112'`.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next, you can use this latitude and longitude information to find the current temperature of San Francisco:
```python
lat = json.loads(response.text)[0]['lat']
lon = json.loads(response.text)[0]['lon']

response = requests .get(f'https://api .openweathermap .org /data /2 .5/weather?lat={lat}&lon={lon}&appid={API_key}')
response_data = json.loads(response.text)
response_data # {'coord': {'lon': -122.4199, 'lat': 37.779}, 'weather': [{'id': 803, --snip-
'timezone': -25200, 'id': 5391959, 'name': 'San Francisco', 'cod': 200}
response_data['main']['temp'] # 285.44

round(285.44 - 273.15, 1)  # Convert Kelvin to Celsius.
12.3
round(285.44 * (9 / 5) - 459.67, 1)  # Convert Kelvin to Fahrenheit.
54.1
```
Notice that OpenWeather returns the temperature in Kelvin, so you’ll need to do some math to get the temperature in Celsius or Fahrenheit.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Let’s break down the full URL of the geolocation endpoint from the previous example:
- ***https://*** = The *scheme* used to access the server, which is the protocol name (almost always HTTPS for online APIs) followed by a colon and two forward slashes.
- ***api.openweathermap.org*** = The domain name of the web server that handles the API request.
- ***/geo/1.0/direct*** = The path of the API.
- ***?q={city_name},{state_code},{country_code}&appid={API_key}*** = The URL’s query string. The parts inside curly brackets need to be replaced by real values; you can think of them as parameters for a function call. In URL encoding, the parameter name and argument value are separated by an equal sign, and multiple parameter-argument pairs are separated by an ampersand.

You can take the endpoint URL (with the completed query string) and paste it into your web browser to view the response text directly. This is often a good practice when you’re first learning how to use an API. The response text for web-based APIs is most often formatted in JSON or XML.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To avoid confusion when updating an API, most online services include a version number as part of the URL. Over time, a service may release new versions of the API and deprecate older versions. At this point, you’ll have to update the code in your scripts to continue to make use of them.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The free tier of OpenWeather also provides five-day forecasts and information about precipitation, wind, and air pollution. The documentation web pages show you what URLs to access to get this data, as well as the structure of the JSON response for these API calls. We'll assume you’ve run `response_data = json.loads(response.text)` to convert the text returned from the website into a Python data structure.

### Requesting a Latitude and Longitude:
The endpoint to get the latitude and longitude coordinates of a city is *https://api.openweathermap.org/geo/1.0/direct?q={city_name},{state_code},{country_code}&appid={API _key}*. The state code refers to the state’s abbreviation and is required only for cities in the United States. The country code is the two- or three-letter ISO 3166 code, listed at *https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes*. For example, use the code `'US'` for the United States or `'NZ'` for New Zealand. After converting the response JSON text into a Python data structure in a variable named `response_data`, you can retrieve the following information:
- **`response_data[0]['lat']:`** Holds the degrees latitude of the city as a float value
- **`response_data[0]['lon']:`** Holds the degrees longitude of the city as a float value

If the city name matches multiple responses, the list in `response_data` will contain different dictionaries at `response_data[0], response_data[1]`, and so on. If OpenWeather is unable to locate the city, response_data will be an empty list.

### Fetching the Current Weather:
The endpoint to get current weather information based on some latitude and longitude is *https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API_key}*. After converting the response JSON text into a Python data structure in a variable named `response_data`, you can retrieve the following information:
- **`response_data['weather'][0]['main']:`** Holds a string description, such as `'Clear'`, `'Rain'`, or `'Snow'`
- **`response_data['weather'][0]['description']:`** Holds a more descriptive string, such as `'light rain'`, `'moderate rain'`, or `'extreme rain'`
- **`response_data['main']['temp']:`** Holds the current temperature in Kelvin
- **`response_data['main']['feels_like']:`** Holds the human perception of the temperature in Kelvin
- **`response_data['main']['humidity']:`** Holds the humidity as a percentage

If you supplied an incorrect latitude or longitude argument, `response_data` will be a dictionary, like `{"cod":"400","message":"wrong latitude"}`.

### Getting a Weather Forecast:
The endpoint to get a five-day forecast based on some latitude and longitude is *https://api.openweathermap.org/data/2.5/forecast?lat={lat}&lon={lon}&appid={API_key}*. After converting the response JSON text into a Python data structure in a variable named response_data, you can retrieve the following information:
- **`response_data['list']:`** Holds a list of dictionaries containing the weather predictions for a given time.
- **`response_data['list'][0]['dt']:`** Holds a timestamp in the form of a Unix epoch float. Pass this value as an argument to `datetime.datetime.fromtimestamp()` to obtain the timestamp as a datetime object.
- **`response_data['list'][0]['main']:`** Holds a dictionary with keys like `'temp'`, `'feels_like'`, `'humidity'`, and others.
- **`response_data['list'][0]['weather'][0]:`** Holds a dictionary of descriptions with keys like `'main'`, `'description'`, and others.

The list in `response_data['list']` holds 40 dictionaries with forecasts at three-hour increments for the next five days, though this may change in future versions of the API.
